<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>나홀로 떠나는 전주여행</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-Rksm4bM8t0YH7LgW1FsKFTQ/8N6Z5cP06/T+3Js9f+g=" crossorigin=""/>
  <!-- Leaflet JS (defer하여 문서 파싱 후 로드) -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j8k9N2t+9sS+VihG63RaHkItmjWc8Yu3r3G4hJM=" crossorigin=""></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <!-- 헤더 -->
  <header class="bg-white shadow-md">
    <div class="container mx-auto flex items-center justify-between py-4 px-6">
      <div class="text-2xl font-bold text-green-600">나홀로 떠나는 전주여행</div>
      <nav class="space-x-4">
        <a href="#" class="text-gray-600 hover:text-green-600">홈</a>
        <a href="#destinations" class="text-gray-600 hover:text-green-600">추천 여행지</a>
        <a href="#reviews" class="text-gray-600 hover:text-green-600">여행 후기</a>
      </nav>
    </div>
  </header>

  <!-- 메인: 일정 생성기 섹션 -->
  <section class="bg-white mt-6 py-8 shadow-lg">
    <div class="container mx-auto px-6">
      <h2 class="text-3xl font-semibold text-center text-gray-800 mb-6">나만의 전주여행 일정 만들기</h2>
      <div class="max-w-xl mx-auto">
        <!-- 언어 선택 -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">언어 선택:</label>
          <select id="languageSelect" class="w-full border rounded-md p-2">
            <option value="ko">한국어</option>
            <option value="en">English</option>
            <option value="ja">日本語</option>
            <option value="zh">中文</option>
          </select>
        </div>
        <!-- 일정 생성 버튼 -->
        <button id="generateBtn" class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700">
          여행 일정 생성하기
        </button>
      </div>
    </div>
  </section>

  <!-- 일정 결과 출력 섹션 -->
  <section id="itineraryResult" class="container mx-auto px-6 mt-8 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h3 class="text-2xl font-semibold text-gray-800 mb-4">생성된 여행 일정</h3>
      <div id="itineraryContent" class="prose mb-6"></div>
      <!-- 지도 표시 영역 -->
      <div id="map" class="w-full h-96 rounded-lg"></div>
    </div>
  </section>

  <!-- 추천 여행지 섹션 -->
  <section id="destinations" class="container mx-auto px-6 mt-12">
    <h2 class="text-3xl font-semibold text-gray-800 mb-6">추천 여행지</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- 추천 카드 1 -->
      <article class="bg-white rounded-lg shadow-lg overflow-hidden">
        <img src="https://source.unsplash.com/400x300?hanok" alt="한옥마을" class="w-full h-48 object-cover" />
        <div class="p-4">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">전주 한옥마을</h3>
          <p class="text-gray-600 text-sm">전통 한옥이 모여 있는 한국의 대표적인 문화 거리. 전통체험과 길거리 음식이 유명하세요.</p>
        </div>
      </article>
      <!-- 추천 카드 2 -->
      <article class="bg-white rounded-lg shadow-lg overflow-hidden">
        <img src="https://source.unsplash.com/400x300?temple" alt="전동성당" class="w-full h-48 object-cover" />
        <div class="p-4">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">전동성당</h3>
          <p class="text-gray-600 text-sm">고딕 양식으로 지어진 전주 전동성당은 아름다운 외관과 여유로운 분위기를 제공합니다.</p>
        </div>
      </article>
      <!-- 추천 카드 3 -->
      <article class="bg-white rounded-lg shadow-lg overflow-hidden">
        <img src="https://source.unsplash.com/400x300?food,korean" alt="남부시장" class="w-full h-48 object-cover" />
        <div class="p-4">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">남부시장</h3>
          <p class="text-gray-600 text-sm">전통 시장의 활기와 다양한 먹거리를 즐길 수 있는 명소입니다.</p>
        </div>
      </article>
    </div>
  </section>

  <!-- 여행 후기 섹션 -->
  <section id="reviews" class="container mx-auto px-6 mt-12 mb-12">
    <h2 class="text-3xl font-semibold text-gray-800 mb-6">여행 후기</h2>
    <div class="space-y-6">
      <!-- 후기 카드 1 -->
      <article class="bg-white rounded-lg shadow-lg p-6">
        <h3 class="text-2xl font-semibold text-gray-800 mb-2">감성 충만 전주 야경 투어 후기</h3>
        <p class="text-gray-600 text-sm">작성자: 여행러 박민수 | 2025.06.10</p>
        <p class="mt-4 text-gray-700">전주 한옥마을의 야경을 걸으며 찍은 사진들, 그리고 맛있는 야시장 음식을 즐긴 이야기를 담았습니다.</p>
        <a href="#" class="inline-block mt-4 text-green-600 font-semibold hover:underline">더 읽기 →</a>
      </article>
      <!-- 후기 카드 2 -->
      <article class="bg-white rounded-lg shadow-lg p-6">
        <h3 class="text-2xl font-semibold text-gray-800 mb-2">전주에서 만난 최고의 콩나물국밥</h3>
        <p class="text-gray-600 text-sm">작성자: 미식가 이준호 | 2025.06.08</p>
        <p class="mt-4 text-gray-700">추운 날씨에 딱! 따끈한 콩나물국밥을 먹으며 느꼈던 그 감동이 아직도 생생합니다.</p>
        <a href="#" class="inline-block mt-4 text-green-600 font-semibold hover:underline">더 읽기 →</a>
      </article>
    </div>
  </section>

  <!-- 푸터 -->
  <footer class="bg-gray-800 text-gray-400 py-6">
    <div class="container mx-auto text-center text-sm">
      <p>&copy; 2025 전주 여행 블로그. All rights reserved.</p>
      <p class="mt-2">Designed with ❤️ by webchorong</p>
    </div>
  </footer>

  <!-- 자바스크립트: 일정 생성 및 지도 표시 -->
  <script>
    // ①: 백엔드 도메인을 환경에 맞게 수정
    const BACKEND_URL = 'https://jeonju-backend.onrender.com';

    document.addEventListener('DOMContentLoaded', () => {
      // 1) 지도 초기화 (Leaflet)
      let map = L.map('map').setView([35.8180, 127.1470], 14);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // (선택) 추후 GPT가 준 장소 좌표들을 플로팅할 때 사용할 함수
      function plotRoute(coordsArray) {
        // coordsArray 예시: [ [lat1,lng1], [lat2,lng2], … ]
        coordsArray.forEach(([lat, lng], idx) => {
          L.marker([lat, lng])
            .addTo(map)
            .bindPopup(`Stop ${idx + 1}`);
        });
        L.polyline(coordsArray, { color: 'blue' }).addTo(map);
      }

      // 2) 버튼 클릭 시 실제 백엔드로 일정 요청
      document.getElementById('generateBtn').addEventListener('click', async () => {
        const resultSection = document.getElementById('itineraryResult');
        const contentDiv = document.getElementById('itineraryContent');
        // 버튼 누르는 즉시 결과 영역 노출
        resultSection.classList.remove('hidden');
        contentDiv.innerHTML = '<p class="text-gray-700">여행 일정을 생성 중입니다...</p>';

        try {
          // (A) 사용자가 선택한 언어 가져오기
          const lang = document.getElementById('languageSelect').value;

          // (B) 백엔드로 POST 요청 보내기
          const response = await fetch(`https://jeonju-backend.onrender.com/api/generate`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              startDate: new Date().toISOString().split('T')[0], // 예시: 오늘 날짜 사용
              days: 3,
              language: lang
            })
          });

          if (!response.ok) {
            throw new Error(`백엔드 오류: ${response.status} ${response.statusText}`);
          }

          const json = await response.json();
          // 백엔드에서 { plan: "GPT가 만든 일정 텍스트 (여러 줄)" } 형태로 응답한다고 가정
          const planText = json.plan || '';
          // 3) 받아온 일정 텍스트를 화면에 렌더
          contentDiv.innerHTML = '<pre class="whitespace-pre-wrap">' + planText + '</pre>';

          // 4) (선택) 지도로 경로 표시
          //    - 만약 백엔드에서 “장소 이름”만 주면, 클라이언트에서 별도 Geocoding(예: Nominatim 등)을 통해 좌표 얻어야 함
          //    - 여기서는 테스트용 샘플 좌표를 그대로 사용
          const sampleCoords = [
            [35.8190, 127.1480], // 한옥마을
            [35.8152, 127.1470], // 전동성당
            [35.8155, 127.1447]  // 남부시장
          ];
          plotRoute(sampleCoords);
          // 지도가 ‘hidden → 보이는 상태’로 전환되었으므로, 사이즈를 다시 계산해 줍니다.
          map.invalidateSize();

        } catch (err) {
          console.error(err);
          contentDiv.innerHTML = `<p class="text-red-600">일정 생성에 실패했습니다: ${err.message}</p>`;
        }
      });
    });
  </script>
</body>
</html>
