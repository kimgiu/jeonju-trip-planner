<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>나홀로 떠나는 전주여행</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<!-- ...head, body, form/table 등 생략... -->
<style>
  body { background: #f4f4f4; }
  #map {
    height: 400px;
    width: 100%;
    min-width: 300px;
    min-height: 400px;
    margin: 2rem 0;
    background: #eee;
    border: 3px solid #444;
    border-radius: 8px;
    box-sizing: border-box;
    display: block;
  }
  .container { max-width: 1100px; margin: 2rem auto; background: #fff; border-radius: 16px; padding: 2rem; box-shadow: 0 2px 16px #0001; }
  /* ...기타 CSS... */
</style>
<!-- ...중략... -->

</head>
<body>
  <h1 style="text-align:center; color:#17a04c; margin:2rem 0 1rem 0;">나홀로 떠나는 전주여행</h1>
  <div class="container">
    <div>
      <label>여행 시작일: <input id="startDate" type="date"></label>
      <label style="margin-left:1em;">여행 일수: <input id="days" type="number" value="2" min="1" max="7" style="width:3em"></label>
      <button id="generateBtn" style="margin-left:1em; padding: 6px 18px; background:#19c46b; color:#fff; border-radius:5px;">여행 일정 생성하기</button>
    </div>
    <div id="plan-table"></div>
    <div id="map"></div>
  </div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // 좌표 하드코딩
    const locationCoords = {
      "전주 한옥마을": [35.8163, 127.1530],
      "전동성당": [35.8146, 127.1472],
      "남부시장": [35.8155, 127.1447],
      "경기전": [35.8158, 127.1475],
      "오목대": [35.8167, 127.1487],
      "자만벽화마을": [35.8144, 127.1465]
    };
    function getCoord(name) {
      return locationCoords[name] || [35.8242, 127.1479];
    }

    // 지도
    let map, mapInit = false;

    document.getElementById('generateBtn').onclick = function() {
      // 예시 데이터 (실제는 백엔드 결과를 여기에)
      const plan = [
        { date: "2025-07-01", slots: [
          { time:"09:00", location:"전주 한옥마을" },
          { time:"12:00", location:"남부시장" },
          { time:"15:00", location:"경기전" }
        ]},
        { date: "2025-07-02", slots: [
          { time:"09:00", location:"전동성당" },
          { time:"12:00", location:"오목대" },
          { time:"15:00", location:"자만벽화마을" }
        ]}
      ];
      // 표
      let html = `<table><thead>
        <tr><th>날짜</th><th>시간</th><th>여행지</th><th>음식점</th><th>숙소(저가/중가/고가)</th></tr>
      </thead><tbody>`;
      plan.forEach(day => day.slots.forEach((slot,i) =>
        html += `<tr>
          <td>${i==0?day.date:""}</td>
          <td>${slot.time}</td>
          <td>${slot.location}</td>
          <td>-</td>
          <td>-</td>
        </tr>`
      ));
      html += `</tbody></table>`;
      document.getElementById('plan-table').innerHTML = html;
      // 지도
      if(!mapInit){
        map = L.map('map').setView([35.8158,127.1475],14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        mapInit = true;
      }
      document.getElementById('map').style.display = 'block';
      // **여기가 핵심! 지도 리사이즈**
      setTimeout(() => { map.invalidateSize(); }, 100);

      map.eachLayer(layer => {if(layer instanceof L.Polyline||layer instanceof L.Marker) map.removeLayer(layer)});
      // 폴리라인/마커
      const colors = ["#007aff", "#e53935", "#43a047", "#fbc02d"];
      plan.forEach((day,idx)=>{
        const color = colors[idx%colors.length];
        const coords = day.slots.map(slot=>getCoord(slot.location));
        L.polyline(coords, {color, weight:5}).addTo(map);
        day.slots.forEach((slot,i)=>
          L.marker(coords[i]).addTo(map)
            .bindPopup(`<b>${day.date} (Day${idx+1})</b><br>${slot.time} - ${slot.location}`)
        );
      });
    };
  </script>
</body>
</html>
