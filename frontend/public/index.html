<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚˜í™€ë¡œ ë– ë‚˜ëŠ” ì „ì£¼ì—¬í–‰ - ì¼ì • ë° ì§€ë„</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body { background: #f7fafc; font-family: 'Noto Sans KR', sans-serif; }
    .main-wrap { max-width: 1200px; margin: 0 auto; padding: 30px 0; }
    .flex { display: flex; gap: 32px; }
    #map { width: 480px; min-width:320px; height: 660px; border-radius: 16px; border: 2px solid #eee; box-sizing: border-box; }
    .itinerary-list { flex: 1; }
    .itinerary-day { background: #fff; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 8px #0002; padding: 18px 24px; }
    .itinerary-day h3 { font-size: 1.3rem; margin: 0 0 10px 0; color: #25863b; }
    .itinerary-item { display: flex; align-items: flex-start; gap: 20px; margin-bottom: 14px; }
    .marker-idx { width:32px; height:32px; border-radius:50%; background:#2ec46d; color:#fff; text-align:center; line-height:32px; font-weight:bold; font-size:1.2rem; margin-top:3px;}
    .detail-card { flex:1; background:#f6fff6; border-radius:7px; padding:10px 14px; }
    .place { font-weight: bold; font-size:1.05em; }
    .resto { color:#369; margin-top:2px;}
    .stay { color:#ad5f00; margin-top:2px;}
    .toolbar { display: flex; gap: 14px; margin-bottom: 22px;}
    .toolbar button { background:#179c4a; color:#fff; font-weight:600; border:none; border-radius:6px; padding:7px 18px; font-size:1em; cursor:pointer; transition:0.18s;}
    .toolbar button:hover { background:#127c3a;}
    @media (max-width: 900px) {
      .flex { flex-direction: column; }
      #map { width: 100%; height: 350px; }
    }
    @media print {
      .toolbar, #map { display:none !important; }
      .main-wrap { max-width: 100%; }
      body { background:#fff; }
    }
  </style>
</head>
<body>
<div class="main-wrap">
  <header>
    <h1 style="font-size:2rem; font-weight:700; color:#179c4a; margin-bottom:26px;">ë‚˜í™€ë¡œ ë– ë‚˜ëŠ” ì „ì£¼ì—¬í–‰</h1>
    <div class="toolbar">
      <button onclick="downloadPDF()">PDF ì €ì¥</button>
      <button onclick="sharePage()">ê³µìœ í•˜ê¸°</button>
      <button onclick="window.print()">ì¸ì‡„í•˜ê¸°</button>
    </div>
  </header>
  <div class="flex">
    <!-- ì§€ë„ -->
    <div id="map"></div>
    <!-- ì¼ì • ë¦¬ìŠ¤íŠ¸ -->
    <div class="itinerary-list" id="itinerary-list">
      <!-- ì¼ì •ì¹´ë“œê°€ JSë¡œ ì¶”ê°€ë¨ -->
    </div>
  </div>
</div>

<!-- Leaflet.js -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const PLACES = [
  {id:'hanok', name:'ì „ì£¼ í•œì˜¥ë§ˆì„', type:'place', lat:35.815924, lng:127.153288},
  {id:'gyonggijeon', name:'ê²½ê¸°ì „', type:'place', lat:35.815893, lng:127.150642},
  {id:'jeondong', name:'ì „ë™ì„±ë‹¹', type:'place', lat:35.814855, lng:127.148799},
  {id:'namboo', name:'ë‚¨ë¶€ì‹œì¥', type:'place', lat:35.813218, lng:127.150408},
  {id:'jaman', name:'ìë§Œë²½í™”ë§ˆì„', type:'place', lat:35.814244, lng:127.156039},
  {id:'omokdae', name:'ì˜¤ëª©ëŒ€', type:'place', lat:35.817579, lng:127.151926},
];
const RESTAURANTS = [
  {name:'ë² í…Œë‘ ì¹¼êµ­ìˆ˜', lat:35.8156, lng:127.1541, menu:'ì¹¼êµ­ìˆ˜', price:'7,000ì›', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ê²½ê¸°ì „ê¸¸ 135', phone:'063-285-9898'},
  {name:'ì‚¼ë°±ì§‘', lat:35.8164, lng:127.1542, menu:'ì½©ë‚˜ë¬¼êµ­ë°¥', price:'9,000ì›', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ì „ë™3ê°€ 2-1', phone:'063-284-2227'},
  {name:'ì™±ì´ì½©ë‚˜ë¬¼êµ­ë°¥', lat:35.8169, lng:127.1547, menu:'ì½©ë‚˜ë¬¼êµ­ë°¥', price:'9,000ì›', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ê²½ê¸°ì „ê¸¸ 20', phone:'063-287-6980'},
  {name:'ì¤‘ì•™íšŒê´€', lat:35.8139, lng:127.1485, menu:'ë¹„ë¹”ë°¥', price:'13,000ì›', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ì „ë™ 2-1', phone:'063-232-8912'},
];
const HOTELS = [
  {grade:'ì €ê°€', name:'ìŠ¤í…Œì´í˜¸í…”', lat:35.8146, lng:127.1565, price:'40,000ì›~', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ìë§Œë™ 123-1', phone:'063-272-1111'},
  {grade:'ì¤‘ê°€', name:'ë¼í•œí˜¸í…”', lat:35.8138, lng:127.1466, price:'110,000ì›~', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ì „ë™ 40-1', phone:'063-230-7000'},
  {grade:'ê³ ê°€', name:'ë¼ë§ˆë‹¤í˜¸í…”', lat:35.8174, lng:127.1502, price:'180,000ì›~', address:'ì „ì£¼ì‹œ ì™„ì‚°êµ¬ í•œì˜¥ë§ˆì„ë¡œ 94', phone:'063-281-8888'},
];

function generatePlan(startDate="2025-07-01", days=2) {
  const itinerary = [];
  const schedule = [
    [
      { time:'09:00', type:'place', ref:PLACES[0] },
      { time:'11:00', type:'place', ref:PLACES[1] },
      { time:'12:00', type:'food', ref:RESTAURANTS[0] },
      { time:'13:00', type:'place', ref:PLACES[2] },
      { time:'15:00', type:'place', ref:PLACES[3] },
      { time:'18:00', type:'food', ref:RESTAURANTS[1] },
      { time:'20:00', type:'stay', ref:HOTELS[1] },
    ],
    [
      { time:'09:00', type:'place', ref:PLACES[4] },
      { time:'11:00', type:'place', ref:PLACES[5] },
      { time:'12:00', type:'food', ref:RESTAURANTS[3] },
      { time:'15:00', type:'place', ref:PLACES[0] },
    ],
  ];
  for(let d=0; d<days; d++){
    const date = new Date(startDate);
    date.setDate(date.getDate()+d);
    itinerary.push({
      day: d+1,
      date: date.toISOString().slice(0,10),
      slots: schedule[d] || [],
    });
  }
  return itinerary;
}

const itinerary = generatePlan();

const map = L.map('map').setView([35.815924, 127.153288], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

function renderItinerary(list) {
  const cont = document.getElementById('itinerary-list');
  cont.innerHTML = '';
  let markerIdx = 1;
  list.forEach(day=>{
    const d = document.createElement('div');
    d.className = 'itinerary-day';
    d.innerHTML = `<h3>${day.day}ì¼ì°¨ <span style="font-size:.95em;color:#666">(${day.date})</span></h3>`;
    day.slots.forEach(slot=>{
      let icon = '';
      let desc = '';
      if(slot.type==='place'){
        icon = `<span class="marker-idx">${markerIdx}</span>`;
        desc = `<div class="detail-card"><div class="place">${slot.ref.name}</div></div>`;
      } else if(slot.type==='food'){
        icon = `<span class="marker-idx" style="background:#1e90ff;">ğŸ´</span>`;
        desc = `<div class="detail-card resto">
          <div class="place">${slot.ref.name} <span style="font-size:.9em">(${slot.ref.menu})</span></div>
          <div>ëŒ€í‘œë©”ë‰´: <b>${slot.ref.menu}</b> <span style="color:#555">(${slot.ref.price})</span></div>
          <div class="text-xs" style="font-size:.85em">ì£¼ì†Œ: ${slot.ref.address}<br>ì „í™”: ${slot.ref.phone}</div>
        </div>`;
      } else if(slot.type==='stay'){
        icon = `<span class="marker-idx" style="background:#ad5f00;">ğŸ¨</span>`;
        desc = `<div class="detail-card stay">
          <div class="place">${slot.ref.grade} | ${slot.ref.name}</div>
          <div>ê°€ê²©: <b>${slot.ref.price}</b></div>
          <div style="font-size:.85em">ì£¼ì†Œ: ${slot.ref.address}<br>ì „í™”: ${slot.ref.phone}</div>
        </div>`;
      }
      d.innerHTML += `<div class="itinerary-item">${icon}<span style="width:80px;">${slot.time}</span>${desc}</div>`;
      markerIdx++;
    });
    cont.appendChild(d);
  });
}

function plotItinerary(list) {
  let prevLatLngs = [];
  let markerIdx = 1;
  list.forEach((day, di)=>{
    let latlngs = [];
    day.slots.forEach(slot=>{
      if(slot.ref.lat && slot.ref.lng){
        latlngs.push([slot.ref.lat, slot.ref.lng]);
        let marker = L.marker([slot.ref.lat, slot.ref.lng]).addTo(map)
          .bindPopup(`${slot.time} ${slot.ref.name}`);
        marker._icon.innerHTML = `<div style="position:relative;left:7px;top:3px;font-size:1.2em;color:#fff;">${markerIdx}</div>`;
        markerIdx++;
      }
    });
    if(latlngs.length>=2) {
      L.polyline(latlngs, {color:['#198754','#0d6efd','#e34c4c'][di%3], weight:4, opacity:0.8}).addTo(map);
    }
    prevLatLngs = prevLatLngs.concat(latlngs);
  });
  if(prevLatLngs.length>0){
    map.fitBounds(prevLatLngs, {padding:[40,40]});
  }
}

renderItinerary(itinerary);
plotItinerary(itinerary);

/* ==========================
  PDFì €ì¥/ê³µìœ /ì¸ì‡„ JS ì¶”ê°€
============================= */
function downloadPDF() {
  // ì¼ì •ë¦¬ìŠ¤íŠ¸ë§Œ ìº¡ì²˜
  const element = document.getElementById('itinerary-list');
  html2canvas(element).then(canvas=>{
    const imgData = canvas.toDataURL('image/png');
    const pdf = new window.jspdf.jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: 'a4'
    });
    // ì´ë¯¸ì§€ A4ë„£ê¸° (ë¹„ìœ¨ìë™)
    const pageWidth = 210, pageHeight = 297;
    const imgProps = pdf.getImageProperties(imgData);
    const imgWidth = pageWidth - 20;
    const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
    pdf.save('ì „ì£¼ì—¬í–‰ì¼ì •.pdf');
  });
}

// ê³µìœ  (ì›¹ê³µìœ  or ë§í¬ë³µì‚¬)
function sharePage() {
  if (navigator.share) {
    navigator.share({
      title: document.title,
      url: window.location.href
    });
  } else {
    // ë³µì‚¬
    const t = document.createElement('textarea');
    t.value = window.location.href;
    document.body.appendChild(t);
    t.select();
    document.execCommand('copy');
    document.body.removeChild(t);
    alert('ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹œêµ¬ì—ê²Œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
  }
}
</script>
</body>
</html>
